# Diese Datei muss global in der Apache Konfiguration Included werden.
# Damit die Skripte funktionieren muss stehen
# ScriptAlias /nest/ <lokaler Ordner der Skripte>
# und der lokale Ordner muss die Option ExecCGI bekommen

RewriteEngine On

# Zugriff auf diese Datei als CGI-Skript verbieten
RewriteRule	^/nest/url.conf$	-			[F]

# cgi-bin
RewriteRule	^/kskscanner$		/cgi-bin/kskscanner	[PT]
RewriteRule	^(/tw)?/save$		/cgi-bin/save		[PT]

# alte PHP-Kartenskripte
RewriteRule	^/send/text/armee$	/karte/k-armee.php	[PT]
RewriteRule	^/send/text/turm$	/karte/k-turm.php	[PT]
RewriteRule	^/send/text/top10$	/karte/datenpflege.php	[PT]
RewriteRule	^/send/text/allianz$	/karte/datenpflege.php	[PT]

# lege saubere und permanente URLs auf aktuelle Skripte
RewriteRule	^/send/terrain$		/nest/terrain.py	[PT]
RewriteRule	^/send/data$		/nest/dispatch.py	[PT]
RewriteRule	^/send/response$	/nest/reich.py		[PT]

# Kopfdaten
RewriteRule	^(/tw)?/show/stylesheet$	/nest/stylesheet.css
RewriteRule	^(/tw)?/show/javascript$	/nest/javascript.js

# Uebersichten
RewriteRule	^(/tw)?/show$		/nest/index.py		[PT]
RewriteRule	^/show/allianzen$	/nest/allianz.py?list=yes	[PT]
RewriteRule	^/show/allianz/(.*)$	/nest/allianz.py?id=$1	[PT]
RewriteRule	^/show/reiche$		/nest/reich.py?list=yes	[PT]
RewriteRule	^/show/reich/(.*)$	/nest/reich.py?id=$1	[PT]
RewriteRule	^/show/armeen$		/nest/armee.py?list=yes	[PT]
RewriteRule	^/show/doerfer$		/nest/dorf.py?list=yes	[PT]
RewriteRule	^/show/wirtschaft$		/nest/wirtschaft.py?list=yes	[PT]

# administratives
RewriteRule	^(/tw)?/show/versionen$	/nest/admin.py?list=versionen	[PT]
RewriteRule	^/delete$		/nest/admin.py?list=delete	[PT]
RewriteRule	^/delete/armee/([0-9]*)/?(yes)?$ \
		/nest/armee.py?id=$1&action=delete&confirmation=$2	[PT]
RewriteRule	^/free/armee/([0-9]*)/?(yes)?$ \
		/nest/armee.py?id=$1&action=free&confirmation=$2	[PT]


# Karten
RewriteRule	^(/tw)?/show/karten$	/nest/karte.py?list=yes	[PT]
RewriteRule	^/show/leos.css$	/karte/leos.css		[PT]

# Details fuer ein Feld
RewriteRule	^/show/feld/([0-9]+)\.([0-9]+)(/(N|U[1-9]+|u[1-9]+))?$ \
		/nest/feld.py?x=$1&y=$2&level=$4		[PT]

# erweitere Defaultkarten
RewriteRule	^(.*)$			-		[E=RESULT:$1]

RewriteCond	%{ENV:RESULT} \
		!.*/(tiny|verysmall|small|normal)$
RewriteRule	(/show/karte)(.*)$ \
		$1$2/normal \
		[E=RESULT:$1$2/normal]

RewriteCond	%{ENV:RESULT} \
		!.*/(armeen|doerfer|clean|neu|alt)(\+(armeen|doerfer|clean|neu|alt))*/[^/]+$
RewriteRule	(/show/karte)(.*)/([^/]+)$ \
		$1$2/armeen\+doerfer/$3 \
		[E=RESULT:$1$2/doerfer/$3]

RewriteCond	%{ENV:RESULT} \
		!.*/(N|u[1-9]|U[1-9])/[^/]+/[^/]+$
RewriteRule	(/show/karte)(.*)/([^/]+)/([^/]+)$ \
		$1$2/N/$3/$4

RewriteRule	(/show/karte)/kraehen/([^/]+)/([^/]+)/([^/]+)$ \
		$1/256.280-289.303/$2/$3/$4
RewriteRule	(/show/karte)/osten/(U|u)([^/]+)/([^/]+)/([^/]+)$ \
		$1/261.0-998.998/U$3/$4/$5
RewriteRule	(/show/karte)/osten/([^/]+)/([^/]+)/([^/]+)$ \
		$1/261.287-292.322/$2/$3/$4
RewriteRule	(/show/karte)/westen/([^/]+)/([^/]+)/([^/]+)$ \
		$1/225.287-261.307/$2/$3/$4
RewriteRule	(/show/karte)/sueden/([^/]+)/([^/]+)/([^/]+)$ \
		$1/229.320-262.341/$2/$3/$4
RewriteRule	(/show/karte)/axt/([^/]+)/([^/]+)/([^/]+)$ \
		$1/231.290-264.311/$2/$3/$4
RewriteRule	(/show/karte)/schuetzen/([^/]+)/([^/]+)/([^/]+)$ \
		$1/222.294-255.315/$2/$3/$4
RewriteRule	(/show/karte)/drache/([^/]+)/([^/]+)/([^/]+)$ \
		$1/204.339-237.360/$2/$3/$4
RewriteRule	(/show/karte)/([^/]+)/([^/]+)/([^/]+)$ \
		$1/000.000-999.999/$2/$3/$4

# finale Rewrite-Rule fuer die Karte
RewriteRule	^(/tw)?/show/karte/([0-9]+)\.([0-9]+)-([0-9]+)\.([0-9]+)/(N|U[1-9]+|u[1-9]+)/([a-z+]+)/([a-z]+)$ \
		/nest/karte.py?group=$1&x1=$2&y1=$3&x2=$4&y2=$5&level=$6&layer=$7&size=$8							[PT]

# schalte Teile fuer einige Externe frei
RewriteRule	^/ext/send/text/armee$	/karte/k-armee.php		[PT]
RewriteRule	^/ext/send/text/turm$	/karte/k-turm.php		[PT]
RewriteRule	^/ext/send/terrain$	/nest/terrain.py		[PT]
RewriteRule	^/ext/send/data$	/nest/dispatch.py		[PT]
RewriteRule	^/ext/send/response$	/nest/reich.py			[PT]


# schalte Teile fuer die TW frei
RewriteRule	^/tw/send/text/armee$	/karte/k-armee.php		[PT]
RewriteRule	^/tw/send/text/turm$	/karte/k-turm.php		[PT]
RewriteRule	^/tw/send/terrain$	/nest/terrain.py		[PT]
RewriteRule	^/tw/send/data$		/nest/dispatch.py		[PT]
RewriteRule	^/tw/send/response$	/nest/reich.py			[PT]

